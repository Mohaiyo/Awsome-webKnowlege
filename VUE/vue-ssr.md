# vue-ssr初探

> 总结在feedforfun ssr上面遇到的问题以及解决方法

## ssr基础知识

### vue-ssr概念

> 服务器渲染的 Vue.js 应用程序也可以被认为是"同构"或"通用"，因为应用程序的大部分代码都可以在服务器和客户端上运行

### why-ssr

- 更好的seo,由于搜索引擎爬虫抓取工具可以直接查看完全渲染的页面
- google与bing可以进行同步代码应用程序进行索引**同步是关键**
- 更快的内容到达时间(time-to-content)

> 进行ssr之前的一些限制于权衡
- 开发条件受限--编写通用代码
- 构建设置与部署更多要求--ssr 需要处于 Node.js server 运行环境
- 更多的服务器端负载

## 滚动加载问题

> 采用指令滚动加载的时候，不同组件之间由于组件监听事件的存在，会导致滚动触发不同组件指令已经加载数据影响
> 采用vue-infinite-scroll实现滚动加载，会报window is undefined，由于服务端不支持window,所以只能把这个指令添加到entry-client.js上进行解决

## 服务端与客户端混合数据失败的问题

> 这个原因主要是服务端渲染的时候没有拿到cookie 所以导致服务端渲染的 html tag 与客户端渲染的html tag不一致导致的混合失败
> 解决办法-在server.js使用cookie-parser解析req的cookie然后通过context传入服务端入口文件entry-server.js 然后放到store.state中，这样就可以在组件中拿到cookie了
> 如果要向服务端传cookie数据，需要把 api拆成两个部分 一个是客户端的一个是sever端的，通过store实例传到服务端的API上，然后放在header头部传给后台，这样后端便可以拿到前端的cookie进行使用了

## nav-header组件为何不使用router-view

> 两个原因
- fb插件需要（此问题测试可以使用增加一层router-view来解决，在性能上面可能会更好，毕竟页面资源不需要重新加载，侧边栏也不需要重绘）
- ga分析要针对不同的页面进行区分，若果使用了router-view，类似于单页面应用，会导致使用了router-view的页面上面设置的ga信息都会纪录在另外一个跳转进来的页面.

## css预编译为啥不用上

- 也想用，但是重构的话一开始用的是模板。样式很多都写好了，只能使用之前已经写好的样式，否则返工需要花比较多的时间进行重新和设计
- 已经用了sass,组件内使用

## 
